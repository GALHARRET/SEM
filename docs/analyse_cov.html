<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Formation SEM – analyse_cov</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Formation SEM</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analyse_cov.html" aria-current="page">
 <span class="menu-text">Analyse de covariance</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./lavaan_example.html">
 <span class="menu-text">Exemple complet sur Lavaan</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#références" id="toc-références" class="nav-link" data-scroll-target="#références">Références</a></li>
  </ul></li>
  <li><a href="#le-modèle-de-médiation-version-1" id="toc-le-modèle-de-médiation-version-1" class="nav-link" data-scroll-target="#le-modèle-de-médiation-version-1">Le modèle de médiation (version 1)</a>
  <ul class="collapse">
  <li><a href="#hypothèses-principales-du-modèle" id="toc-hypothèses-principales-du-modèle" class="nav-link" data-scroll-target="#hypothèses-principales-du-modèle">Hypothèses principales du modèle:</a></li>
  <li><a href="#hypothèses-additionnelles" id="toc-hypothèses-additionnelles" class="nav-link" data-scroll-target="#hypothèses-additionnelles">Hypothèses additionnelles</a></li>
  <li><a href="#matrice-de-corrélation-du-modèle" id="toc-matrice-de-corrélation-du-modèle" class="nav-link" data-scroll-target="#matrice-de-corrélation-du-modèle">Matrice de corrélation du modèle</a></li>
  <li><a href="#approche-par-moindres-carrés" id="toc-approche-par-moindres-carrés" class="nav-link" data-scroll-target="#approche-par-moindres-carrés">Approche par moindres carrés</a></li>
  <li><a href="#exemple-sur-lavaan" id="toc-exemple-sur-lavaan" class="nav-link" data-scroll-target="#exemple-sur-lavaan">Exemple sur lavaan</a></li>
  </ul></li>
  <li><a href="#modèle-de-médiation-version-2" id="toc-modèle-de-médiation-version-2" class="nav-link" data-scroll-target="#modèle-de-médiation-version-2">Modèle de médiation (version 2)</a>
  <ul class="collapse">
  <li><a href="#matrice-de-corrélation-du-modèle-1" id="toc-matrice-de-corrélation-du-modèle-1" class="nav-link" data-scroll-target="#matrice-de-corrélation-du-modèle-1">Matrice de corrélation du modèle</a></li>
  </ul></li>
  <li><a href="#retour-au-modèle-général" id="toc-retour-au-modèle-général" class="nav-link" data-scroll-target="#retour-au-modèle-général">Retour au modèle général</a></li>
  <li><a href="#formule-de-jorëskog" id="toc-formule-de-jorëskog" class="nav-link" data-scroll-target="#formule-de-jorëskog">Formule de Jorëskog</a></li>
  <li><a href="#modèles-récursifs" id="toc-modèles-récursifs" class="nav-link" data-scroll-target="#modèles-récursifs">Modèles récursifs</a>
  <ul class="collapse">
  <li><a href="#exercice" id="toc-exercice" class="nav-link" data-scroll-target="#exercice">Exercice</a></li>
  </ul></li>
  <li><a href="#estimation-de-sigmatheta" id="toc-estimation-de-sigmatheta" class="nav-link" data-scroll-target="#estimation-de-sigmatheta">Estimation de <span class="math inline">\(\Sigma(\theta)\)</span></a>
  <ul class="collapse">
  <li><a href="#maximum-de-vraisemblance" id="toc-maximum-de-vraisemblance" class="nav-link" data-scroll-target="#maximum-de-vraisemblance">Maximum de vraisemblance</a></li>
  <li><a href="#approches-pondérées" id="toc-approches-pondérées" class="nav-link" data-scroll-target="#approches-pondérées">Approches pondérées</a></li>
  <li><a href="#comparaison-de-ces-approches" id="toc-comparaison-de-ces-approches" class="nav-link" data-scroll-target="#comparaison-de-ces-approches">Comparaison de ces approches</a></li>
  </ul></li>
  <li><a href="#mesure-de-qualité-du-modèle" id="toc-mesure-de-qualité-du-modèle" class="nav-link" data-scroll-target="#mesure-de-qualité-du-modèle">Mesure de qualité du modèle</a>
  <ul class="collapse">
  <li><a href="#premières-vérifications" id="toc-premières-vérifications" class="nav-link" data-scroll-target="#premières-vérifications">Premières vérifications</a></li>
  <li><a href="#test-du-chi2-jöreskog-1967" id="toc-test-du-chi2-jöreskog-1967" class="nav-link" data-scroll-target="#test-du-chi2-jöreskog-1967">Test du <span class="math inline">\(\chi¨2\)</span> (Jöreskog 1967)</a>
  <ul class="collapse">
  <li><a href="#références-1" id="toc-références-1" class="nav-link" data-scroll-target="#références-1">références</a></li>
  </ul></li>
  <li><a href="#indices-absolu-modèle-de-mesure" id="toc-indices-absolu-modèle-de-mesure" class="nav-link" data-scroll-target="#indices-absolu-modèle-de-mesure">Indices absolu (modèle de mesure) :</a></li>
  <li><a href="#indices-incrémentaux-modèle-de-mesure" id="toc-indices-incrémentaux-modèle-de-mesure" class="nav-link" data-scroll-target="#indices-incrémentaux-modèle-de-mesure">Indices incrémentaux (modèle de mesure) :</a></li>
  <li><a href="#indices-de-parcimonie" id="toc-indices-de-parcimonie" class="nav-link" data-scroll-target="#indices-de-parcimonie">Indices de parcimonie</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<div class="cell">

</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Toutes les notions développées ont été développées par Jöreskog (1970) qui a crée le premier logiciel de référence LISREL (Jöreskog et Sörbom 1996).</p>
<p>Un livre de référence contenant les notions abordées est Bollen (1989).</p>
<p>On va se placer dans le cadre <strong>Path-Analysis</strong> qui est plus simple (au niveau des notations) c’est à dire avec uniquement des variables observées. Toutes les notions et formulent se généralisent sans difficulté aux SEM intégrant un modèle de mesure.</p>
<section id="références" class="level3">
<h3 class="anchored" data-anchor-id="références">Références</h3>
<ul>
<li><p>Jöreskog, K.G., Sörbom, D., 1996. LISREL 8 : User’s Reference Guide. Scientific Software International, Inc.&nbsp;28, 142, 187</p></li>
<li><p>Bollen, K., 1989. Structural equations with latent variables. Wiley-Interscience. 28, 30, 57</p></li>
</ul>
</section>
</section>
<section id="le-modèle-de-médiation-version-1" class="level1">
<h1>Le modèle de médiation (version 1)</h1>
<ul>
<li><span class="math inline">\(\xi_1\)</span> : variable exogène (variable d’exposition)</li>
<li><span class="math inline">\(\eta_1\)</span> : variable endogène (variable médiatrice)</li>
<li><span class="math inline">\(\eta_2\)</span> : variable endogène (variable réponse)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analyse_cov_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<section id="hypothèses-principales-du-modèle" class="level2">
<h2 class="anchored" data-anchor-id="hypothèses-principales-du-modèle">Hypothèses principales du modèle:</h2>
<ul>
<li><p>Les erreurs <span class="math inline">\(\zeta_j\)</span> et les variables exogènes <span class="math inline">\(\xi_i\)</span> ne sont pas corrélées</p></li>
<li><p>Les erreurs <span class="math inline">\(\zeta_j\)</span> ne sont pas corrélées entre elles.</p></li>
</ul>
</section>
<section id="hypothèses-additionnelles" class="level2">
<h2 class="anchored" data-anchor-id="hypothèses-additionnelles">Hypothèses additionnelles</h2>
<p>Ces hypothèses ne servent qu’à simplifier l’écriture du modèle, elles ne seront pas nécessairement vérifiées en pratique.</p>
<p>Les variables endogènes et exogènes sont standardisées</p>
<p><span class="math display">\[
\mathbb E(\eta_j)=\mathbb E(\xi_k)=0, \ \mathbb V(\eta_j)=\mathbb V(\xi_k)=0
\]</span></p>
</section>
<section id="matrice-de-corrélation-du-modèle" class="level2">
<h2 class="anchored" data-anchor-id="matrice-de-corrélation-du-modèle">Matrice de corrélation du modèle</h2>
<p>On a le système d’équations linéaires</p>
<p><span class="math display">\[
\begin{cases}
\eta_1=a\xi_1+\zeta_1 \\
\eta_2=c\xi_1+b\eta_1+\zeta_2
\end{cases}
\]</span> On note <span class="math inline">\(\sigma^2_k\)</span> les variances des erreurs <span class="math inline">\(\zeta_k\)</span>.</p>
<p>Compte tenu de toutes les hypothèses précédentes on peut écrire la matrice de corrélation impliquée :</p>
<p><span class="math display">\[
\Sigma(a,b,c)=\left( \begin{array}{ccc}
1 &amp; a &amp; ab+c \\
&amp; a^2+\sigma_1^2 &amp; b+ca \\
&amp;  &amp; c^2+b^2+abc+\sigma_2^2
\end{array}
\right)
\]</span></p>
<p>On considère la matrice de corrélation observée :</p>
<p><span class="math display">\[
S=\left( \begin{array}{ccc}
1 &amp; r_{12} &amp; r_{13} \\
&amp; 1 &amp; r_{23} \\
&amp;  &amp; 1
\end{array}
\right)
\]</span> On a donc 5 paramètres à estimer avec 5 observations. L’ajustement va donc être parfait (aux erreurs numériques près) !</p>
</section>
<section id="approche-par-moindres-carrés" class="level2">
<h2 class="anchored" data-anchor-id="approche-par-moindres-carrés">Approche par moindres carrés</h2>
<p>En analyse de régression on veut minimiser la somme des carrés écarts des points du nuage aux valeurs prédites (OLS : Ordinary Least Squared) ici on veut minimiser :</p>
<p><span class="math display">\[F_{ULS}=\frac1{2}\Vert \Sigma-S\Vert^2,\]</span> où <span class="math inline">\(\Vert&nbsp;\bullet \Vert\)</span> est la norme de Frobenius. Cette estimation s’appelle ULS (Unweighted Least Squared)</p>
<p><strong>Remarque</strong> : Les estimateurs des moindres carrés et du maximum de vraisemblance coïncident dans le cas de la régression ce n’est pas le cas avec les matrices de covariance (il faudra pondérer par une matrice <span class="math inline">\(W\)</span>).</p>
</section>
<section id="exemple-sur-lavaan" class="level2">
<h2 class="anchored" data-anchor-id="exemple-sur-lavaan">Exemple sur lavaan</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="st">"44"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="fu">rnorm</span>(n)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sigM<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sigY<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>c<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>M<span class="ot">&lt;-</span>a<span class="sc">*</span>X<span class="sc">+</span><span class="fu">rnorm</span>(n,<span class="dv">0</span>,sigM)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">&lt;-</span>c<span class="sc">*</span>X<span class="sc">+</span>b<span class="sc">*</span>M<span class="sc">+</span><span class="fu">rnorm</span>(n,<span class="dv">0</span>,sigY)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="st">'</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="st">M~a*X</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">Y~c*X+b*M</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="st">## effets</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="st">I:=a*b</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="st">T:=a*b+c</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">M=</span>M,<span class="at">Y=</span>Y,<span class="at">X=</span>X)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">sem</span>(model,<span class="at">data=</span>df)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

  Number of observations                           100

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  M ~                                                 
    X          (a)    0.970    0.086   11.256    0.000
  Y ~                                                 
    X          (c)    2.823    0.265   10.649    0.000
    M          (b)    1.935    0.204    9.472    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .M                 0.938    0.133    7.071    0.000
   .Y                 3.917    0.554    7.071    0.000

Defined Parameters:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
    I                 1.877    0.259    7.247    0.000
    T                 4.700    0.243   19.381    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrice de covariance observée</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         M         Y        X
M 2.148846  7.652921 1.238055
Y 7.652921 35.697306 5.998395
X 1.238055  5.998395 1.276278</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrice de covariance estimée avec le modèle</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$cov
       M      Y      X
M  2.127              
Y  7.576 35.340       
X  1.226  5.938  1.264</code></pre>
</div>
</div>
</section>
</section>
<section id="modèle-de-médiation-version-2" class="level1">
<h1>Modèle de médiation (version 2)</h1>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analyse_cov_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<section id="matrice-de-corrélation-du-modèle-1" class="level2">
<h2 class="anchored" data-anchor-id="matrice-de-corrélation-du-modèle-1">Matrice de corrélation du modèle</h2>
<p>On a le système d’équations linéaires</p>
<p><span class="math display">\[
\begin{cases}
\eta_1=a\xi_1+\zeta_1 \\
\eta_2=b\eta_1+\zeta_2
\end{cases}
\]</span></p>
<p>La matrice de corrélation impliquée :</p>
<p><span class="math display">\[
\Sigma(a,b,c)=\left( \begin{array}{ccc}
1 &amp; a &amp; ab\\
&amp; a^2+\sigma_1^2 &amp; b \\
&amp;  &amp; b^2+\sigma_2^2
\end{array}
\right)
\]</span></p>
<p>Dans ce cas il nous reste un degré de liberté !</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="st">'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">M~a*X</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">Y~b*M</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">## effets</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">I:=a*b</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>res2<span class="ot">&lt;-</span><span class="fu">sem</span>(model,<span class="at">data=</span>df)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 2 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         4

  Number of observations                           100

Model Test User Model:
                                                      
  Test statistic                                75.796
  Degrees of freedom                                 1
  P-value (Chi-square)                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  M ~                                                 
    X          (a)    0.970    0.086   11.256    0.000
  Y ~                                                 
    M          (b)    3.561    0.198   17.968    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .M                 0.938    0.133    7.071    0.000
   .Y                 8.358    1.182    7.071    0.000

Defined Parameters:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
    I                 3.455    0.362    9.539    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrice de covariance observée</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         M         Y        X
M 2.148846  7.652921 1.238055
Y 7.652921 35.697306 5.998395
X 1.238055  5.998395 1.276278</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrice de covariance estimée avec le modèle</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(res2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$cov
       M      Y      X
M  2.127              
Y  7.576 35.340       
X  1.226  4.365  1.264</code></pre>
</div>
</div>
<p>Dans ca cas on voit que l’on estime beaucoup moins bien la covariance <span class="math inline">\(X,Y\)</span>. C’était attendu puisqu”il n’y a plus de path entre <span class="math inline">\(X\)</span> et <span class="math inline">\(Y\)</span> alors que <span class="math inline">\(c=3\)</span> !</p>
</section>
</section>
<section id="retour-au-modèle-général" class="level1">
<h1>Retour au modèle général</h1>
<p>On suppose que le modèle possède</p>
<ul>
<li><p><span class="math inline">\(q\)</span> variables exogènes <span class="math inline">\(\xi_1,...,\xi_p\)</span></p></li>
<li><p><span class="math inline">\(p\)</span> variables endogènes <span class="math inline">\(\eta_1,...,\eta_p\)</span></p></li>
<li><p>Pour tout <span class="math inline">\(j=1,...,q\)</span> <span class="math display">\[\eta_j=\sum_{i\in J} \beta_{j,i}\eta_i+\sum_{k= 1}^p\gamma_{j,i}\xi_k+\zeta_j\]</span> où <span class="math inline">\(J=\{1,...,p\}- \{j \}\)</span> et <span class="math inline">\(\zeta_k\)</span> est l’erreur du modèle.</p></li>
</ul>
<p>On écrit :</p>
<p><span class="math display">\[\eta_{(p\times 1)}= \Gamma_{(p\times q)}\xi_{(p\times q)}+ {\bf B}_{(p\times p)}\eta_{(p\times q)}+ \zeta_{(p\times 1)}\]</span></p>
</section>
<section id="formule-de-jorëskog" class="level1">
<h1>Formule de Jorëskog</h1>
<p>On considère les matrices de corrélation des variables exogènes et des erreurs <span class="math display">\[\Phi=\mathbb E(\xi\xi^T), \quad \Psi=\mathbb E(\zeta\zeta^T) \]</span></p>
<p><span class="math display">\[\boxed{\Sigma(\theta)=\left( \begin{array}{cc}
\Phi &amp; \Phi \Gamma^T\widetilde B^T \\
\widetilde B \Gamma \Phi &amp; \widetilde B(    \Gamma \Phi \Gamma^T+\Psi)\widetilde B^T
\end{array}\right)}\]</span></p>
<p>où <span class="math inline">\(\tilde B=(I-\bf{B})^{-1},\)</span> et <span class="math inline">\(\theta\)</span> est l’ensemble des paramètres à estimer.</p>
</section>
<section id="modèles-récursifs" class="level1">
<h1>Modèles récursifs</h1>
<p>Un modèle est récursif lorsque <span class="math inline">\({\bf B}\)</span> est triangulaire supérieure (ou inférieure).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analyse_cov_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[{\bf B}=\left(\begin{array}{ccc}
0 &amp; a &amp; c \\
0 &amp; 0 &amp; b \\
0 &amp; 0 &amp; 0
\end{array}\right)\]</span></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analyse_cov_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[{\bf B}=\left(\begin{array}{ccc}
0 &amp; a &amp; 0 \\
0 &amp; 0 &amp; b \\
c &amp; 0 &amp; 0
\end{array}\right)\]</span></p>
<section id="exercice" class="level3">
<h3 class="anchored" data-anchor-id="exercice">Exercice</h3>
<p>Déterminer les matrices <span class="math inline">\({\bf B}, \Gamma.\)</span></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analyse_cov_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="estimation-de-sigmatheta" class="level1">
<h1>Estimation de <span class="math inline">\(\Sigma(\theta)\)</span></h1>
<p>Soit <span class="math inline">\(\theta\)</span> le vecteur des paramètres à estimer (on suppose qu’il contient <span class="math inline">\(t\)</span> paramètres).</p>
<p>Le but est de déterminer <span class="math inline">\(\theta\)</span> pour que <span class="math display">\[\Sigma(\theta)\simeq S,\]</span> l’estimation étant la “meilleure possible”.</p>
<p>Comme souvent en statistique, cela revient à minimiser une fonction de coût <span class="math inline">\(F\)</span>. On suppose que cette fonction <span class="math inline">\(F\)</span> vérifie :</p>
<p>A. <span class="math inline">\(F(S,\Sigma(\theta))\geq 0\)</span></p>
<p>B. <span class="math inline">\(F(S,\Sigma(\theta))= 0\)</span> si et seulement si <span class="math inline">\(S= \Sigma(\theta))\)</span></p>
<p>C. <span class="math inline">\(F\)</span> est continue en <span class="math inline">\(S\)</span> et en <span class="math inline">\(\Sigma(\theta).\)</span></p>
<p><strong>Remarque :</strong></p>
<p>Le nombre de paramètres <span class="math inline">\(t\)</span> à estimer peut être grand il doit de toute façon vérifier ` <span class="math display">\[
t &lt; \frac{(p+q)(p+q+1)}{2}
\]</span></p>
<section id="maximum-de-vraisemblance" class="level2">
<h2 class="anchored" data-anchor-id="maximum-de-vraisemblance">Maximum de vraisemblance</h2>
<p>[Jöreskog, K. G. (1967), “Some Contributions to Maximum Likelihood Factor Analysis,” Psychometrika, 32, 44]</p>
<p>On suppose que :</p>
<ul>
<li><p><span class="math inline">\((x_1,...,x_p,y_1,...,y_q)^T \sim \mathcal N (0,\Sigma)\)</span>, où <span class="math inline">\(\Sigma\)</span> est la matrice de covariance des variables <span class="math inline">\(\bf{x,y}\)</span> (sur la population).</p></li>
<li><p><span class="math inline">\(\Sigma\)</span> et <span class="math inline">\(S\)</span> sont définies positives.</p></li>
</ul>
<p>La première hypothèse revient à considérer que l’ensemble de l’information entre les variables impliquées est contenue dans les moments d’ordre 1 et 2 (moyennes et covariances).</p>
<p>Un premier problème peut se poser si la matrice <span class="math inline">\(S\)</span> n’est pas définie positive ….</p>
<p>On a : <span class="math display">\[F_{ML}(\theta)=\log|\Sigma|+trace(S\Sigma^{-1})-\log|S|-(p+q),\]</span></p>
<p><strong><em>Important</em></strong></p>
<ul>
<li><p><span class="math inline">\(F_{ML}\)</span> a bien les 3 propriétés attendues.</p></li>
<li><p>La solution n’est pas toujours explicite <span class="math inline">\(\leadsto\)</span> procédures algorithmiques pour le calculer.</p></li>
<li><p>Asymptotiquement, <span class="math inline">\(\widehat \theta_{ML}\)</span> est non biaisé, consistant, efficace (ie parmi les estimateurs consistants de <span class="math inline">\(\theta\)</span> il a la plus petite variance asymptotique).</p></li>
<li><p>La distribution de <span class="math inline">\(\widehat \theta_{ML}\)</span> est normale <span class="math inline">\(\leadsto\)</span> on peut faire des tests…</p></li>
</ul>
</section>
<section id="approches-pondérées" class="level2">
<h2 class="anchored" data-anchor-id="approches-pondérées">Approches pondérées</h2>
<p><span class="math display">\[
F_{W}=\frac 1{2}trace\left( [S-\Sigma(\theta)]^2W^{-1}\right),
\]</span> où <span class="math inline">\(W\)</span> est une matrice de poids (définie positive) pour la partie résiduelle du modèle.</p>
<ul>
<li><p>Lorsque <span class="math inline">\(W=I\)</span> il s’agit de la méthode des moindres carrés non pondérés <span class="math inline">\(ULS\)</span> (cf Jöreskog (1977) “Structural Equation Models in the Social Sciences: Specification, Estimation and Testing,” in Applications of Statistics, P. R. Krishnaiah, ed.&nbsp;Amsterdam: North-Holland Publishing Co., 265-87) Dans ce cas l’analogie avec la régression OLS est évidente.</p></li>
<li><p>Lorsque <span class="math inline">\(W=S\)</span> il s’agit de la méthode des moindres carrés généralisés <span class="math inline">\(GLS\)</span> (cf Browne, M. W. (1974). Generalized least squares estimators in the analysis of covariance structures. South African Statistical Journal, 8, 1–24.)</p></li>
</ul>
<p><strong>Remarque</strong></p>
<p>Pour assurer des bonnes propriétés à <span class="math inline">\(\widehat \theta_{GLS}\)</span> il faut ajouter quelques hypothèses, mais en pratique elles sont souvent moins restrictives que celles pour le ML.</p>
<p>Autre approche : Browne, M.W. (1984), Asymptotically distribution-free methods for the analysis of covariance structures. British Journal of Mathematical and Statistical Psychology, 37: 62-83. <a href="https://doi.org/10.1111/j.2044-8317.1984.tb00789.x" class="uri">https://doi.org/10.1111/j.2044-8317.1984.tb00789.x</a></p>
<p><span class="math display">\[
F_{WLS}=\frac 1{2}trace\left( [S-\Sigma(\theta)]^TW^{-1}[S-\Sigma(\theta)]\right),
\]</span></p>
<ul>
<li><p>Si on prend <span class="math inline">\(W=S\)</span> qui est (sous certaines conditions) une estimation asymptotique de la matrice de covariance de la population.</p></li>
<li><p>Le gros inconvenient de cette approche est qu’elle nécessite un très grand nombre d’observation (<span class="math inline">\(n&gt;1000\)</span>).</p></li>
<li><p>On peut considérer une matrice de poids diagonale (DWLS)</p></li>
<li><p>Pour des variables mesurées ordinales (ce qui est le cas dans la plupart des applications), sous la condition qu’elles mesurent une variable latente continue, Muthen (1984) a développé une approche robuste dérivée de WLS basée sur la matrice de corrélations polychoriques qui montre de très bonnes propriétés en pratique.</p></li>
</ul>
</section>
<section id="comparaison-de-ces-approches" class="level2">
<h2 class="anchored" data-anchor-id="comparaison-de-ces-approches">Comparaison de ces approches</h2>
<ul>
<li>Si on considère la normalité des variables <span class="math inline">\(\bf{x,y}\)</span> ces trois approches sont asymptotiquement équivalentes.</li>
</ul>
<p><strong>Quelques références de comparaison de ces méthodes : </strong></p>
<ul>
<li><p>Ulf Henning Olsson , Tron Foss , Sigurd V. Troye &amp; Roy D. Howell (2000) The Performance of ML, GLS, and WLS Estimation in Structural Equation Modeling Under Conditions of Misspecification and Nonnormality, Structural Equation Modeling: A Multidisciplinary Journal, 7:4, 557-595, DOI: 10.1207/S15328007SEM0704_3</p></li>
<li><p>Li CH. The performance of ML, DWLS, and ULS estimation with robust corrections in structural equation models with ordinal variables. Psychol Methods. 2016 Sep;21(3):369-87. doi: 10.1037/met0000093. PMID: 27571021.</p></li>
</ul>
<p><strong>Conclusion :</strong></p>
<p>Il existe d’autres approches MLR, FIM, …</p>
</section>
</section>
<section id="mesure-de-qualité-du-modèle" class="level1">
<h1>Mesure de qualité du modèle</h1>
<section id="premières-vérifications" class="level2">
<h2 class="anchored" data-anchor-id="premières-vérifications">Premières vérifications</h2>
<p>Avant toute interprétation on peut vérifier si l’algorithme d’estimation a bien convergé en vérifiant :</p>
<ul>
<li><p>aucune variance n’est négative,</p></li>
<li><p>aucune corrélation n’est supérieure à 1 (ou inférieure à <span class="math inline">\(-1\)</span>),</p></li>
<li><p>la matrice de covariance est non définie positive.</p></li>
</ul>
<p>Ensuite il exsite de très nombreux indices d’ajustements différents. On va en regarder quelques uns.</p>
</section>
<section id="test-du-chi2-jöreskog-1967" class="level2">
<h2 class="anchored" data-anchor-id="test-du-chi2-jöreskog-1967">Test du <span class="math inline">\(\chi¨2\)</span> (Jöreskog 1967)</h2>
<p>On teste <span class="math inline">\(H_0 : \Sigma(\theta)=\Sigma\)</span> contre <span class="math inline">\(H_1 : \Sigma(\theta)\not =\Sigma\)</span></p>
<p>On teste cette hypothèse par un rapport de vraisemblance (on ramène <span class="math inline">\(H_0\)</span> à <span class="math inline">\(\Sigma(\hat \theta)=S\)</span>)</p>
<p><span class="math display">\[
T=-2(\log(L_0(\hat\theta))-\log(L_1(\hat\theta))=(n-1)F_{ML}
\]</span> Sous des conditions de régularité et avec <span class="math inline">\(n\)</span> grand la statistique <span class="math inline">\(T\sim \chi^2\)</span> à <span class="math inline">\(k=\frac1{2}(p+q)(p+q+1)-t\)</span> degré de liberté.</p>
<p>La méthode d’estimation des paramètres par maximum de vraisemblance n’est que très peu biaisée en cas de non normalité alors que la statistique <span class="math inline">\(T\)</span> l’est et ce test est beaucoup trop peu conservateur.</p>
<p>Bollen (1986) propose une version standardisée de <span class="math inline">\(T\)</span> (une loi du <span class="math inline">\(\chi^2\)</span> a pour moyenne <span class="math inline">\(k\)</span> et variance <span class="math inline">\(2k\)</span>) donc on considère <span class="math inline">\(\tilde T=\frac{T-k}{\sqrt{2k}}\)</span></p>
<p>Enfin Satorra-Bentler (1999) propose une une version de <span class="math inline">\(T=c^{-1}T\)</span> où <span class="math inline">\(c\)</span> est l’applatissement de la courbe (kurtosis).</p>
<section id="références-1" class="level3">
<h3 class="anchored" data-anchor-id="références-1">références</h3>
<ul>
<li><p>Bollen, K., 1986. Sample size and Bentler and Bonett’s nonnormed fit index. Psychometrika 51(3), 375–377. 32</p></li>
<li><p>Satorra, A., Bentler, P.M., 1999. Corrections to test statistics and standard errors in covariance struc- ture analysis. In : Von Eye, A., Clogg, C. (Eds.), Latent Variables Analysis, Applications to Deve- lopmental Research. Thousand Oaks, Ca, Sage, pp.&nbsp;399–419. 32, 36</p></li>
</ul>
</section>
</section>
<section id="indices-absolu-modèle-de-mesure" class="level2">
<h2 class="anchored" data-anchor-id="indices-absolu-modèle-de-mesure">Indices absolu (modèle de mesure) :</h2>
<p>Il existe d’autres indices qui sont listés dans le tableau suivant ils ont tous leurs qualités et leurs défauts, aucun ne s’étant révélé idéal empiriquement.</p>
<p><img src="table1.png" class="img-fluid"></p>
</section>
<section id="indices-incrémentaux-modèle-de-mesure" class="level2">
<h2 class="anchored" data-anchor-id="indices-incrémentaux-modèle-de-mesure">Indices incrémentaux (modèle de mesure) :</h2>
<p>On va comparer le modèle estimé au modèle “nul” c’est à dire au modèle qui suppose la non-corrélation de toutes les variables observées et des variables latentes associées (on notera <span class="math inline">\(T_0\)</span> la statistique associée à ce modèle). Un indice dit “incrémental” mesure l’amélioration de l’ajustement entre le modèle nul et le modèle testé. Là-encore il existe beaucoup d’indices</p>
<p><img src="table2.png" class="img-fluid"></p>
</section>
<section id="indices-de-parcimonie" class="level2">
<h2 class="anchored" data-anchor-id="indices-de-parcimonie">Indices de parcimonie</h2>
<p>Les questions de sur-estimation et sous-estimation de modèles doivent être posées, le cas le plus fréquent est la sur-estimation du modèle qui induira une augmentation artificielle de l’ajustement du modèle aux données. Ils permettent en particulier de trouver un juste milieu entre deux buts opposés : minimiser le nombre de coefficients à estimer et d’autre part améliorer la qualité d’ajustement du modèle aux données. Ces indices sont des indices de comparaisons de plusieurs modèles concurrents, on utilise par exemple les indices <span class="math inline">\(AIC,BIC\)</span>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>